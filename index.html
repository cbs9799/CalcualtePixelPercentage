<!DOCTYPE html>
<html>
<head>
    <title>Calculate Pixel Percentage</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #output {
            margin-top: 20px;
            text-align: center;
        }
        h1 {
            font-size: 2em;
            font-weight: bold;
        }
        p {
            font-size: 1em;
        }
        #output img {
            max-width: 600px;
            height: auto;
        }
    </style>
</head>
<body>
    <!-- 제목 -->
    <h1>Calculate Pixel Percentage</h1>
    <!-- 설명 -->
    <p>이미지의 밝기를 퍼센트로 보여줍니다.</p>
    <!-- 이미지 파일을 선택할 수 있는 입력 필드 -->
    <input type="file" id="input" accept="image/*">
    <!-- 결과를 출력할 영역 -->
    <div id="output"></div>

    <script>
        // 파일 선택 입력 필드에 이벤트 리스너를 추가
        document.getElementById('input').addEventListener('change', function(e) {
            // 선택된 파일을 가져옴
            let file = e.target.files[0];
            // FileReader 객체 생성
            let reader = new FileReader();
            // 파일 읽기가 완료되면 실행되는 이벤트 핸들러
            reader.onload = function(event) {
                // 이미지 객체 생성
                let img = new Image();
                // 이미지 로딩이 완료되면 실행되는 이벤트 핸들러
                img.onload = function() {
                    // 캔버스 생성
                    let canvas = document.createElement('canvas');
                    // 캔버스의 너비와 높이를 이미지의 너비와 높이로 설정
                    canvas.width = img.width;
                    canvas.height = img.height;
                    // 캔버스의 2D 렌더링 컨텍스트를 가져옴
                    let ctx = canvas.getContext('2d');
                    // 캔버스에 이미지를 그림
                    ctx.drawImage(img, 0, 0, img.width, img.height);
                    // 캔버스의 이미지 데이터를 가져옴
                    let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    // 전체 밝기를 저장할 변수
                    let totalBrightness = 0;
                    // 이미지 데이터를 순회하면서 각 픽셀의 밝기를 계산
                    for (let i = 0; i < imageData.data.length; i += 4) {
                        let r = imageData.data[i];
                        let g = imageData.data[i + 1];
                        let b = imageData.data[i + 2];
                        let a = imageData.data[i + 3];
                        let brightness = ((r + g + b) / 3 / 255) * (a / 255);
                        totalBrightness += brightness;
                        brightness = brightness * 255; // 밝기를 0-255 범위로 변환
                        imageData.data[i] = brightness;     // Red
                        imageData.data[i + 1] = brightness; // Green
                        imageData.data[i + 2] = brightness; // Blue
                        imageData.data[i + 3] = 255; // Alpha
                    }
                    // 캔버스에 변경된 이미지 데이터를 적용
                    ctx.putImageData(imageData, 0, 0);
                    // 평균 밝기를 계산
                    let avgBrightness = totalBrightness / (imageData.data.length / 4) * 100; // 백분율로 변환
                    
                    // 이미지의 너비가 600px를 초과하는 경우
                    if (canvas.width > 600) {
                        // 이미지의 비율을 계산
                        let ratio = canvas.height / canvas.width;
                        // 캔버스의 스타일 너비를 600px로 설정
                        canvas.style.width = '600px';
                        // 캔버스의 스타일 높이를 비율에 맞게 설정
                        canvas.style.height = (600 * ratio) + 'px';
                    }
                    
                    // 결과를 화면에 출력
                    document.getElementById('output').innerHTML = 
                        '이미지 너비: ' + img.width + 'px<br>' +
                        '이미지 높이: ' + img.height + 'px<br>' +
                        '파일 크기: ' + Math.round(file.size / 1024) + 'KB<br>' +
                        '평균 밝기 백분율: ' + avgBrightness.toFixed(2) + '%<br>' +
                        '<img src="' + canvas.toDataURL() + '">';
                }
                // 이미지 객체의 src 속성을 파일의 데이터 URL로 설정
                img.src = event.target.result;
            }
            // 파일을 데이터 URL로 읽음
            reader.readAsDataURL(file);
        });
    </script>
</body>
</html>
