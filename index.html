<!DOCTYPE html>
<html>
<head>
<style>
/* CSS 스타일링: 화면 중앙에 내용이 위치하도록 설정 */
body {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    background-color: #f0f0f0;
    font-family: Arial, sans-serif;
}

#output {
    text-align: center;
    margin-top: 20px;
}

#resultImage {
    max-width: 1080px;
    height: auto;
}
</style>
</head>
<body>
<!-- 이미지 파일 선택 입력 필드 -->
<input type="file" id="imageFile" name="imageFile" accept="image/*">
<!-- 결과 출력 영역 -->
<div id="output"></div>
<!-- 결과 이미지 출력 영역 -->
<img id="resultImage">

<script>
// 이미지 파일 선택 입력 필드에 이벤트 리스너 추가
document.getElementById('imageFile').addEventListener('change', function(e) {
    // 선택된 파일 가져오기
    var file = e.target.files[0];
    var reader = new FileReader();
    reader.onload = function(e) {
        var img = new Image();
        img.onload = function() {
            // 캔버스 생성 및 이미지 그리기
            var canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, img.width, img.height);
            // 이미지 데이터 가져오기
            var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            var data = imageData.data;
            var totalBrightness = 0;
            // 이미지 데이터를 순회
            for (let i = 0; i < imageData.data.length; i += 4) {
                // 픽셀의 RGBA 값을 가져옴
                let r = imageData.data[i];
                let g = imageData.data[i + 1];
                let b = imageData.data[i + 2];
                let a = imageData.data[i + 3];
            
                // 픽셀의 밝기를 계산 (RGB의 평균)
                let brightness = (r + g + b) / 3;
            
                // 픽셀이 투명한 경우, 해당 픽셀을 불투명한 검은색으로 설정
                if (a === 0) {
                    imageData.data[i] = 0;     // Red
                    imageData.data[i + 1] = 0; // Green
                    imageData.data[i + 2] = 0; // Blue
                    imageData.data[i + 3] = 255; // Alpha
                } else {
                    // 픽셀이 투명하지 않은 경우, 밝기에 따라 픽셀 색상을 설정
                    imageData.data[i] = brightness;     // Red
                    imageData.data[i + 1] = brightness; // Green
                    imageData.data[i + 2] = brightness; // Blue
                }

            }
            // 이미지 데이터 업데이트
            ctx.putImageData(imageData, 0, 0);
            // 전체 픽셀 수 계산
            var totalPixels = img.width * img.height;
            // 평균 밝기 백분율 계산
            var averageBrightnessPercentage = (totalBrightness / (totalPixels * 255)) * 100;
            // 결과 출력
            var output = "Image width: " + img.width + "px<br>";
            output += "Image height: " + img.height + "px<br>";
            output += "File size: " + (file.size / 1024).toFixed(2) + "KB<br>";
            output += "Average brightness percentage: " + averageBrightnessPercentage.toFixed(2) + "%";
            document.getElementById('output').innerHTML = output;
            // 결과 이미지 출력
            document.getElementById('resultImage').src = canvas.toDataURL();
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
});
</script>

</body>
</html>
